import t,{Component as s}from"react";const i={display:"inline-block"};class e extends s{constructor(t){super(t),this.str=(this.props.children||"").replaceAll(" "," ")}componentDidMount(){this.props.parent||(this.init(),this.run())}componentWillUnmount(){clearInterval(this.interval)}init(){var t;this.iteration=!this.props.rewind||null!==(t=this.props.parent)&&void 0!==t&&t.props.rewind?0:this.str.length-1,this.stopped=!1,this.setState({display:null}),this.onStart()}run(){var t;const s=this.props.pause||(null===(t=this.props.parent)||void 0===t?void 0:t.props.pause)||0;setTimeout(()=>{this.updateInterval()},s)}updateInterval(){var t,s;clearInterval(this.interval);let i=" "!=this.str[this.iteration]?this.props.pace||(null===(t=this.props.parent)||void 0===t?void 0:t.props.pace)||40:this.props.whiteSpacePace||(null===(s=this.props.parent)||void 0===s?void 0:s.props.whiteSpacePace)||this.props.pace||40;this.interval=setInterval(()=>this.play(),i)}checkForWhiteSpace(){(" "==this.str[this.iteration]&&" "!=this.lastChar||" "!=this.str[this.iteration]&&" "==this.lastChar)&&this.updateInterval(),this.lastChar=this.str[this.iteration]}play(){if(this.checkForWhiteSpace(),!this.stopped){var s,e;const r=this.props.stamp||(null===(s=this.props.parent)||void 0===s?void 0:s.props.stamp),p=this.props.rewind||(null===(e=this.props.parent)||void 0===e?void 0:e.props.rewind);if(r)this.setState({display:t.createElement("span",{style:i,className:this.props.charClassName,key:Date.now()},this.str)},()=>{this.iteration=p?0:this.props.children.length-1,this.onChar(),this.stop()});else{const s=this.str.substr(0,this.iteration+1).split("");let e;p?(e=s.map((s,i)=>t.createElement("span",{className:this.props.charClassName,style:{display:"inline-block",animation:"none"},key:i},s)),e.pop(),e.push(t.createElement("span",{style:i,className:this.props.charClassName,key:Date.now()},s.slice(-1)))):e=s.map((s,e)=>t.createElement("span",{style:i,className:this.props.charClassName,key:e},s)),this.setState({display:e},()=>{this.iteration+=p?-1:1,p&&this.iteration<-1||!p&&this.iteration>this.str.length?this.stop():this.onChar()})}}}replay(){this.init(),this.run()}show(){this.setState({display:this.str.split("").map((s,e)=>t.createElement("span",{style:i,key:e},s))})}stop(){this.props.loop?this.replay():(this.stopped=!0,this.onStop())}onStart(){var t,s;null===(t=(s=this.props).onStart)||void 0===t||t.call(s,this)}onChar(){var t,s,i,e,r,p;const o=(null===(t=this.props.parent)||void 0===t?void 0:t.props.rewind)||this.props.rewind?this.str[this.iteration+1]:this.str[this.iteration-1];null===(s=(i=this.props).onChar)||void 0===s||s.call(i,o,this),null===(e=this.props.parent)||void 0===e||null===(r=(p=e.props).onChar)||void 0===r||r.call(p,o,this.props.parent)}onStop(){var t,s,i,e;clearInterval(this.interval),null===(t=(s=this.props).onStop)||void 0===t||t.call(s,this),null===(i=this.props)||void 0===i||null===(e=i.parent)||void 0===e||e.play()}render(){var s;return t.createElement("div",{className:this.props.className,style:{display:this.props.block?"block":"inline-block"}},(null===(s=this.state)||void 0===s?void 0:s.display)||" ")}}class r extends s{constructor(t){super(t),this.textRefs=[],t.first&&(r.first=this),this.init()}static play(t){var s;null===(s=r.typos.get(t))||void 0===s||s.replay()}static stop(t){var s;null===(s=r.typos.get(t))||void 0===s||s.stop()}componentDidMount(){this.props.stop||Array.from(r.typos.values()).some(t=>t.props.next==this.name)&&r.first!=this||(this.init(),this.play())}init(){this.initiated=!1,this.textRefs.forEach(t=>{var s;return null===(s=t.current)||void 0===s?void 0:s.init()}),this.texts=t.Children.map(this.props.children,s=>{let i=t.createRef();return this.textRefs.push(i),t.createElement(e,Object.assign({},s.props,{ref:i,parent:this,rewind:this.props.rewind||s.props.rewind}),s.props.children||"")}),this.iteration=this.props.rewind?1==this.texts.length?0:this.texts.length-1:0,this.name=this.props.name||"_"+Math.random().toString(36).substr(2,9),r.typos.set(this.name,this)}play(){if(this.initiated||(this.onStart(),this.initiated=!0),this.props.rewind&&this.iteration<0||!this.props.rewind&&this.iteration>this.texts.length-1)this.stop();else{var t,s,i,e;if(this.props.rewind)for(let t=this.iteration;t>=0;t--){var r;null===(r=this.textRefs[t].current)||void 0===r||r.show()}null===(t=this.textRefs[this.iteration])||void 0===t||null===(s=t.current)||void 0===s||s.init(),null===(i=this.textRefs[this.iteration])||void 0===i||null===(e=i.current)||void 0===e||e.run(),this.iteration+=this.props.rewind?-1:1,this.onText()}}replay(){this.init(),this.play()}stop(){this.onStop()}onStart(){var t,s;null===(t=(s=this.props).onStart)||void 0===t||t.call(s,this)}onText(){var t,s;const i=this.props.rewind?null===(t=this.textRefs[this.iteration+1])||void 0===t?void 0:t.current:null===(s=this.textRefs[this.iteration-1])||void 0===s?void 0:s.current;var e,r;i&&(null===(e=(r=this.props).onText)||void 0===e||e.call(r,i,this))}onStop(){var t,s,i,e;null===(t=(s=this.props).onStop)||void 0===t||t.call(s,this),this.props.next&&(null===(i=r.typos.get(this.props.next))||void 0===i||i.init(),null===(e=r.typos.get(this.props.next))||void 0===e||e.play())}render(){return t.createElement("div",{className:this.props.className,style:{display:"inline-block"}},this.texts)}}r.typos=new Map;export{e as Text,r as Typo};
