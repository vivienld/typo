import t,{Component as i}from"react";function s(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,(Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}var n={display:"inline-block"},r=function(i){function r(t){var s;return(s=i.call(this,t)||this).str=(s.props.children||"").replaceAll(" "," "),s}s(r,i);var e=r.prototype;return e.componentDidMount=function(){this.props.parent||(this.init(),this.run())},e.componentWillUnmount=function(){clearInterval(this.interval)},e.init=function(){var t;this.iteration=!this.props.rewind||null!==(t=this.props.parent)&&void 0!==t&&t.props.rewind?0:this.str.length-1,this.stopped=!1,this.setState({display:null}),this.onStart()},e.run=function(){var t,i=this,s=this.props.pause||(null===(t=this.props.parent)||void 0===t?void 0:t.props.pause)||0;setTimeout(function(){i.updateInterval()},s)},e.updateInterval=function(){var t,i,s=this;clearInterval(this.interval);var n=" "!=this.str[this.iteration]?this.props.pace||(null===(t=this.props.parent)||void 0===t?void 0:t.props.pace)||40:this.props.whiteSpacePace||(null===(i=this.props.parent)||void 0===i?void 0:i.props.whiteSpacePace)||this.props.pace||40;this.interval=setInterval(function(){return s.play()},n)},e.checkForWhiteSpace=function(){(" "==this.str[this.iteration]&&" "!=this.lastChar||" "!=this.str[this.iteration]&&" "==this.lastChar)&&this.updateInterval(),this.lastChar=this.str[this.iteration]},e.play=function(){var i=this;if(this.checkForWhiteSpace(),!this.stopped){var s,r,e=this.props.stamp||(null===(s=this.props.parent)||void 0===s?void 0:s.props.stamp),o=this.props.rewind||(null===(r=this.props.parent)||void 0===r?void 0:r.props.rewind);if(e)this.setState({display:t.createElement("span",{style:n,className:this.props.charClassName,key:Date.now()},this.str)},function(){i.iteration=o?0:i.props.children.length-1,i.onChar(),i.stop()});else{var p,a=this.str.substr(0,this.iteration+1).split("");o?((p=a.map(function(s,n){return t.createElement("span",{className:i.props.charClassName,style:{display:"inline-block",animation:"none"},key:n},s)})).pop(),p.push(t.createElement("span",{style:n,className:this.props.charClassName,key:Date.now()},a.slice(-1)))):p=a.map(function(s,r){return t.createElement("span",{style:n,className:i.props.charClassName,key:r},s)}),this.setState({display:p},function(){i.iteration+=o?-1:1,o&&i.iteration<-1||!o&&i.iteration>i.str.length?i.stop():i.onChar()})}}},e.replay=function(){this.init(),this.run()},e.show=function(){this.setState({display:this.str.split("").map(function(i,s){return t.createElement("span",{style:n,key:s},i)})})},e.stop=function(){this.props.loop?this.replay():(this.stopped=!0,this.onStop())},e.onStart=function(){var t,i;null===(t=(i=this.props).onStart)||void 0===t||t.call(i,this)},e.onChar=function(){var t,i,s,n,r,e,o=(null===(t=this.props.parent)||void 0===t?void 0:t.props.rewind)||this.props.rewind?this.str[this.iteration+1]:this.str[this.iteration-1];null===(i=(s=this.props).onChar)||void 0===i||i.call(s,o,this),null===(n=this.props.parent)||void 0===n||null===(r=(e=n.props).onChar)||void 0===r||r.call(e,o,this.props.parent)},e.onStop=function(){var t,i,s,n;clearInterval(this.interval),null===(t=(i=this.props).onStop)||void 0===t||t.call(i,this),null===(s=this.props)||void 0===s||null===(n=s.parent)||void 0===n||n.play()},e.render=function(){var i;return t.createElement("div",{className:this.props.className,style:{display:this.props.block?"block":"inline-block"}},(null===(i=this.state)||void 0===i?void 0:i.display)||" ")},r}(i),e=function(i){function n(t){var s;return(s=i.call(this,t)||this).textRefs=[],t.first&&(n.first=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(s)),s.init(),s}s(n,i),n.play=function(t){var i;null===(i=n.typos.get(t))||void 0===i||i.replay()},n.stop=function(t){var i;null===(i=n.typos.get(t))||void 0===i||i.stop()};var e=n.prototype;return e.componentDidMount=function(){var t=this;this.props.stop||Array.from(n.typos.values()).some(function(i){return i.props.next==t.name})&&n.first!=this||(this.init(),this.play())},e.init=function(){var i=this;this.initiated=!1,this.textRefs.forEach(function(t){var i;return null===(i=t.current)||void 0===i?void 0:i.init()}),this.texts=t.Children.map(this.props.children,function(s){var n=t.createRef();return i.textRefs.push(n),t.createElement(r,Object.assign({},s.props,{ref:n,parent:i,rewind:i.props.rewind||s.props.rewind}),s.props.children||"")}),this.iteration=this.props.rewind?1==this.texts.length?0:this.texts.length-1:0,this.name=this.props.name||"_"+Math.random().toString(36).substr(2,9),n.typos.set(this.name,this)},e.play=function(){if(this.initiated||(this.onStart(),this.initiated=!0),this.props.rewind&&this.iteration<0||!this.props.rewind&&this.iteration>this.texts.length-1)this.stop();else{var t,i,s,n;if(this.props.rewind)for(var r=this.iteration;r>=0;r--){var e;null===(e=this.textRefs[r].current)||void 0===e||e.show()}null===(t=this.textRefs[this.iteration])||void 0===t||null===(i=t.current)||void 0===i||i.init(),null===(s=this.textRefs[this.iteration])||void 0===s||null===(n=s.current)||void 0===n||n.run(),this.iteration+=this.props.rewind?-1:1,this.onText()}},e.replay=function(){this.init(),this.play()},e.stop=function(){this.onStop()},e.onStart=function(){var t,i;null===(t=(i=this.props).onStart)||void 0===t||t.call(i,this)},e.onText=function(){var t,i,s,n,r=this.props.rewind?null===(t=this.textRefs[this.iteration+1])||void 0===t?void 0:t.current:null===(i=this.textRefs[this.iteration-1])||void 0===i?void 0:i.current;r&&(null===(s=(n=this.props).onText)||void 0===s||s.call(n,r,this))},e.onStop=function(){var t,i,s,r;null===(t=(i=this.props).onStop)||void 0===t||t.call(i,this),this.props.next&&(null===(s=n.typos.get(this.props.next))||void 0===s||s.init(),null===(r=n.typos.get(this.props.next))||void 0===r||r.play())},e.render=function(){return t.createElement("div",{className:this.props.className,style:{display:"inline-block"}},this.texts)},n}(i);e.typos=new Map;export{r as Text,e as Typo};
